<div class="section">
  <div class="container">
    <% if current_user %>
      <nav class="nav nav-logged">
        <div class="nav-actions"> 
          <%= link_to "Główna", root_path, class: "nav-boxes" %>
          <%= link_to "Dodaj", new_offert_path, class: "nav-boxes" %>
          <%= link_to 'Wyloguj', user_session_path(current_user), data: { turbo_method: :delete }, class: "nav-boxes" %>
        </div>
          <a  class="link-edu" href="https://guides.rubyonrails.org/getting_started.html">Edukacja</a>
      </nav>
    <% else %>
      <nav class="nav nav-anonim">
        <div class="nav-actions"> 
          <%= link_to "Główna", root_path, class: "nav-boxes" %>
          <%= link_to "Zaloguj", new_user_session_path, class: "nav-boxes" %>
          <%= link_to 'Dołącz', new_user_path, class: "nav-boxes" %>
        </div>
        <a  class="link-edu" href="https://guides.rubyonrails.org/getting_started.html">Edukacja</a>
      </nav>
    <% end %>


    <h1 class="primary-header offert--details-header"><%= @offert.title %></h1>
    <p class="offert--details-text">
        <%= @offert.body %>
    </p>
    <p class="contact">
      Kontakt:
        <span class="phone_number">
            <%= @offert.phone_number %>
        <span>
    </p>

    <div class="offert-actions">
        <%= form_with model: @offert, class: "cv--send-form" , url: add_cv_offert_path(@offert) ,local: true, multipart: true do |form| %>
          <div class="form-div">
            <%= form.label :cv,  "Dodaj CV (PDF)", class: "form-label", for: "file" %>
            <%= form.file_field :cv, class: "form-button file-btn", id: "file", required: true %>
            <%= form.submit "Prześlij", class: "form--submit-btn"%>
          </div>
          <p class="file-name"><%= flash[:notice] if flash[:notice].present? %></p>
        <% end %>

      <div class="logged--offert-actions">
        <% if current_user.present? && @offert.owner_name == current_user.name %>
          <div>
              <%= link_to "Edytuj".html_safe, edit_offert_path(@offert), class: "form-edit" %>
          </div>
          <div>
              <%= link_to "Usuń ofertę".html_safe, offert_path(@offert), data:{
                turbo_method: :delete,
                turbo_confirm: "Czy napewno chcesz usunąć ofertę?"
              }, class: "form-delete" %>
          </div>
        <% end %>
      </div>
    </div>

      <% if @offert.cv.attached? && current_user.present? && @offert.owner_name == current_user.name %>
          <div >
            <p class="cv-title">Złożone CV:</p>
            <ul class="cv-list">
              <% @offert.cv.each do |cv| %>
                <li class="cv">
                  <%= form_with url: delete_cv_offert_path(@offert, cv.id), method: :delete, local: true do |form| %>
                    <%= form.submit 'Usuń CV', data: { turbo_confirm: 'Czy na pewno chcesz usunąć to CV?' }, class: "delete-cv" %>
                  <% end %>
                  <%= link_to cv.filename, download_cv_offert_path(@offert, cv.id), class: "cv-link" %>
                </li>
              <% end %>
            </ul>
          </div>
        <% end %>

  </div>
</div>

<script>
  let file ='';
  file = document.querySelector('#file');
  file.addEventListener('change', (e) => {
  const [file] = e.target.files;
  const { name: fileName, size } = file;
  const fileSize = (size / 1000).toFixed(2);
  const fileNameAndSize = `${fileName} - ${fileSize}KB`;
  document.querySelector('.file-name').textContent = fileNameAndSize;
});
</script>